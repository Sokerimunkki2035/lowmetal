<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <title>DoomKitara + Rummut</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
      padding: 20px;
    }
    h1 { color: #cc0000; }
    .controls, .fretboard {
      margin: 20px auto;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .note-btn, .drum-btn, select, input[type="range"] {
      background: #222;
      color: #fff;
      border: 1px solid #444;
      padding: 12px 18px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
    }
    .note-btn:hover, .drum-btn:hover { background: #333; }
  </style>
</head>
<body>
  <h1>DoomKitara</h1>

  <div class="controls">
    <label for="tuning">Viritys:</label>
    <select id="tuning">
      <option value="dropA">Drop A</option>
      <option value="dropG">Drop G</option>
    </select>
  </div>

  <div class="fretboard" id="fretboard"></div>

  <div class="controls">
    <label for="duration">Soinnun kesto:</label>
    <input type="range" id="duration" min="0.1" max="3" step="0.1" value="1">
    <span id="durationValue">1.0s</span>
  </div>

  <div class="controls">
    <button class="drum-btn" onclick="startDrum('drum1')">Rumpukomppi 1</button>
    <button class="drum-btn" onclick="startDrum('drum2')">Rumpukomppi 2</button>
    <button class="drum-btn" onclick="stopDrums()">⏹️ Stop</button>
  </div>

  <div class="controls">
    <label for="volume">Rumpujen äänenvoimakkuus:</label>
    <input type="range" id="volume" min="-60" max="0" step="1" value="0">
    <span id="volumeValue">0 dB</span>
  </div>

  <script src="https://unpkg.com/tone@next"></script>
  <script>
    const tunings = {
      dropA: ['A1', 'E2', 'A2', 'D3', 'F3', 'B3'],
      dropG: ['G1', 'D2', 'G2', 'C3', 'E3', 'A3']
    };

    const synth = new Tone.FMSynth({
      oscillator: { type: 'square' },
      envelope: { attack: 0.01, decay: 0.2, sustain: 0.4, release: 1.5 }
    });

    const distortion = new Tone.Distortion(0.8);
    synth.connect(distortion);
    distortion.toDestination();

    document.body.addEventListener('click', async () => {
      await Tone.start();
    }, { once: true });

    const fretboard = document.getElementById('fretboard');
    const tuningSelect = document.getElementById('tuning');
    const durationSlider = document.getElementById('duration');
    const durationDisplay = document.getElementById('durationValue');
    const volumeSlider = document.getElementById('volume');
    const volumeDisplay = document.getElementById('volumeValue');

    durationSlider.oninput = () => {
      durationDisplay.textContent = durationSlider.value + 's';
    };

    volumeSlider.oninput = () => {
      const db = volumeSlider.value;
      drums.volume.value = db;
      volumeDisplay.textContent = db + ' dB';
    };

    function getNoteDuration() {
      return durationSlider.value + 's';
    }

    function buildFretboard() {
      fretboard.innerHTML = '';
      const notes = tunings[tuningSelect.value];
      notes.forEach(note => {
        const btn = document.createElement('button');
        btn.className = 'note-btn';
        btn.textContent = note;
        btn.onclick = () => synth.triggerAttackRelease(note, getNoteDuration());
        fretboard.appendChild(btn);
      });
    }

    tuningSelect.onchange = buildFretboard;
    buildFretboard();

    const drumSamples = {
      drum1: 'https://cdn.glitch.global/8fbd67ca-0279-4894-9122-b48c3d17bb9a/doom_drum_loop1.mp3',
      drum2: 'https://cdn.glitch.global/8fbd67ca-0279-4894-9122-b48c3d17bb9a/doom_drum_loop2.mp3'
    };

    const drums = new Tone.Players(drumSamples, () => {
      console.log('Rummut ladattu');
    }).toDestination();

    drums.volume.value = 0;

    function startDrum(id) {
      Object.values(drums.players).forEach(player => player.stop());
      const player = drums.player(id);
      player.loop = true;
      player.autostart = false;
      player.start();
    }

    function stopDrums() {
      Object.values(drums.players).forEach(player => player.stop());
    }
  </script>
</body>
</html>
